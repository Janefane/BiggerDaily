# 楔子

希望自己能够结合所学知识做一款，自己的App，明白做App的流程。

制作要求：

1、能不用别人写的控件就不要用（自己摸索着实现原理）

2、每天坚持写制作笔记，内容有：对某一页的分析、对功能的制作流程、自己不会的地方

暂时就这些

# 第一天的制作

## 分析知乎日报的引导页所需要的功能

![](https://github.com/newbiechen1024/BiggerDaily/blob/develop/app/screenshot/splash_activity.png)

根据知乎的动态图（这里只有静态图片），有这样几个效果

1、标语从底部，向上显示

2、制作一个View，动态的显示Logo

3、让图片逐渐显示

4、显示图片完成之后跳转

5、动态加载图片

## 分析每部分锁需要的技术

###一、标语从底部，向上显示

利用补间动画，制作该效果。从效果上可知使用 translate 标签，那么如何从底部往上升。

补间动画的参数有三种：具体数值，自身百分比%，父控件百分比%p。位移的位置，根据自身位置，相加。就是说：自身大小为10，本身在y=0处，那么使用100%就是在y=10处。只要设置初始的Y=自身的大小（就隐藏起来了），然后再设置Y=0则又回到原来的位置了，然后对Animation设置监听，当完成时候，启动Logo动画

###二、制作一个View，动态的显示Logo(LogoView)

制作要求：

1、制作Logo的边框

2、制作Logo的动态显示，能够设置动画开始，并有动画结束的监听

3、能够自由设置Logo及边框的颜色、Logo的粗细程度 （这可以没必要，用来练手的）

4、支持wrap_content，可以不用支持padding

制作：

1、边框使用canvas.drawRoundRect()绘制（Canvas一般图形的绘制）

2、利用属性动画ValueAnimation，获取扇形扫过的面积，然后利用canvas.drawArc()或者Path.addArc()来绘制扇形。当currenAngle == sweep_angle 触发完成的回调。设置开启动画的方法(属性动画的时候，Path绘制基本图形)

3、通过使用attr自定义View的属性。(利用attr自定义View属性)

4、通过重写View的onMeasure()方法(View的绘制流程)

遇到的问题：

canvas.drawRoundRect()设置圆角的效果太差，圆角效果的制作还是使用 shape -> corners 好，但是个人认为如果将边框和Logo的动态显示分开成一个drawable和一个View的，是不符合逻辑的（他们本来应该是一个整体）。但是找不到更好的在View中绘制圆角效果的方法（<strong color="#FF0000">暂时放弃</strong>，还是使用canvas.drawRoundRect()来完成）

###三、让图片逐渐显示 四、跳转

创建补间动画，是逐渐显示所以应该使用aplha来实现效果。设置从 0 -> 1 就是渐变功能了。当动画完成之后，设置回调跳转到MainActivity的监听

###五、如何实现动态加载图片

要求：

1、不要等待图片加载出来之后，才能进入到MainActivity。但是又不能没有图片。

2、不要每次打开App的时候都要加载一次图。

3、图片的大小，必须不超过指定大小

解决方法：

1、首先判断缓存中是否有图片，如果没有图片则调用app自身准备的图片。同样当加载新图的时候还是使用之前缓存的图片，然后下次开启的时候，缓存的图片变为新图了（引导图的加载逻辑）

2、创建二级缓存类，根据url地址作为缓存的键值名。但是这里又有一个问题，为了实现实时更换引导图，那么url地址也是固定的，如果使用缓存的话，相同的url的地址首先会从缓存中获取，而不是从网络中获取了。所以解决办法是，定时清空一次缓存，或者说设定一个URL的有效期，如果url超过有效期，那么强制重新获取图片，不经过缓存。（引导图的实现逻辑）

定时清空缓存：在SharedPreference中设定url首次加载的时间和持续的时间。当时间过期，则强制执行。

给url设定有效时间：当超过有效期的时候重新加载

3、需要设置图片压缩类，来压缩图片

制作：

1、创建图片加载类(ImageLoader)

流程：

1、输入网址之后，首先将网址经过MD5加密成HexString(因为网址有太多的非转义字符，容易报错，所以需要转化成HexString)，作为键名。

2、首先从一级缓存判断是否存在与键名相同的值(图片)，如果没有，则从二级缓存中查找（如果查找到了，需要对图片进行压缩之后，并添加到一级缓存中，最后返回Bitmap）。如果二级缓存中也没有，就从网络中加载。

3、当网络中加载完成的时候，就将得到的数据存储的二级缓存中。之后利用二级缓存查找获取Bitmap(因为能够对图片进行压缩，还可以添加到一级缓存中)




