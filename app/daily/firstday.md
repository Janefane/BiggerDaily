# 楔子

希望自己能够结合所学知识做一款，自己的App，明白做App的流程。

制作要求：

1、能不用别人写的控件就不要用（自己摸索着实现原理）

2、每天坚持写制作笔记，内容有：对某一页的分析、对功能的制作流程、自己不会的地方

暂时就这些

# 第一天的制作

## 分析知乎日报的引导页所需要的功能

![](https://github.com/newbiechen1024/BiggerDaily/blob/develop/app/screenshot/splash_activity.png)

根据知乎的动态图（这里只有静态图片），有这样几个效果

1、标语从底部，向上显示

2、制作一个View，动态的显示Logo

3、让图片逐渐显示

4、显示图片完成之后跳转

5、动态加载图片

## 分析每部分锁需要的技术

### 一、标语从底部，向上显示

利用补间动画，制作该效果。从效果上可知使用 translate 标签，那么如何从底部往上升。

补间动画的参数有三种：具体数值，自身百分比%，父控件百分比%p。位移的位置，根据自身位置，相加。就是说：自身大小为10，本身在y=0处，那么使用100%就是在y=10处。只要设置初始的Y=自身的大小（就隐藏起来了），然后再设置Y=0则又回到原来的位置了，然后对Animation设置监听，当完成时候，启动Logo动画

### 二、制作一个View，动态的显示Logo(LogoView)

制作要求：

1、制作Logo的边框

2、制作Logo的动态显示，能够设置动画开始，并有动画结束的监听

3、能够自由设置Logo及边框的颜色、Logo的粗细程度 （这可以没必要，用来练手的）

4、支持wrap_content，可以不用支持padding

制作：

1、边框使用canvas.drawRoundRect()绘制（Canvas一般图形的绘制）

2、利用属性动画ValueAnimation，获取扇形扫过的面积，然后利用canvas.drawArc()或者Path.addArc()来绘制扇形。当currenAngle == sweep_angle 触发完成的回调。设置开启动画的方法(属性动画的时候，Path绘制基本图形)

3、通过使用attr自定义View的属性。(利用attr自定义View属性)

4、通过重写View的onMeasure()方法(View的绘制流程)

遇到的问题：

canvas.drawRoundRect()设置圆角的效果太差，圆角效果的制作还是使用 shape -> corners 好，但是个人认为如果将边框和Logo的动态显示分开成一个drawable和一个View的，是不符合逻辑的（他们本来应该是一个整体）。但是找不到更好的在View中绘制圆角效果的方法（<strong color="#FF0000">暂时放弃</strong>，还是使用canvas.drawRoundRect()来完成）

###三、让图片逐渐显示 四、跳转

创建补间动画，是逐渐显示所以应该使用aplha来实现效果。设置从 0 -> 1 就是渐变功能了。当动画完成之后，设置回调跳转到MainActivity的监听

###五、如何实现动态加载图片

要求：

1、不要等待图片加载出来之后，才能进入到MainActivity。但是又不能没有图片。

2、不要每次打开App的时候都要加载一次图。

3、图片的大小，必须不超过指定大小

解决方法：

1、首先判断缓存中是否有图片，如果没有图片则调用app自身准备的图片。同样当加载新图的时候还是使用之前缓存的图片，然后下次开启的时候，缓存的图片变为新图了（网络交互类）

2、创建二级缓存类，根据url地址作为缓存的键值名。

3、需要设置图片压缩类，来压缩图片

制作：

一、创建图片加载类(ImageLoader)

流程：

1、输入网址之后，首先将网址经过MD5加密成HexString(因为网址有太多的非转义字符，容易报错，所以需要转化成HexString)，作为键名。

2、首先从一级缓存判断是否存在与键名相同的值(图片)，如果没有，则从二级缓存中查找（如果查找到了，需要对图片进行压缩之后，并添加到一级缓存中，最后返回Bitmap）。如果二级缓存中也没有，就从网络中加载。

3、当网络中加载完成的时候，就将得到的数据存储的二级缓存中。之后利用二级缓存查找获取Bitmap(因为能够对图片进行压缩，还可以添加到一级缓存中)

二、创建图片压缩类(ImageResize)

原先的想法：

直接获取网络的流，然后利用BitmapFactory.decodeStream()对传过来的图片进行压缩之后传递给DiskCache存储。发现这个计划是不可行的。原因：图片压缩的原理是首先读取流之后，获取图片的大小数据，设置压缩参数之后，再对流进行读取图片的数据。当进行对流的二次读取的时候，因为第一次已经读取完数据了，第二次读取的时候，就获取不到任何数据了。   

改进后的想法：

首先将图片数据存储到DiskCache中，然后在读取的时候，获取文件流(InputStream)强转成FileDescriptor类(因为是该流是文件流，所以可以进行强制转换)，然后使用BitmapFactory.decodeFileDescriptor()获取图片数据。因为FileDescriptor的指针是可以回溯或者说是可以通过程序移动的。

三、创建网络交互类（基于OkHttp外部依赖）

首先简单的封装OKHttp类，1、设置CookJar。 2、继承Callback接口，将在子线程中执行的Callback接口，通过Handler转化到主线程中的抽象类。  3、根据要求，制作出同步加载数据的接口。







